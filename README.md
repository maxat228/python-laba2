# Лабораторная работа №2: Мини-оболочка с файловыми командами

**Выполнил:** Романенко Максим Александрович  
**Группа:** М8О-102БВ-25

---

## Цель работы

Реализовать мини-оболочку с набором основных файловых команд, аналогичных командам Unix-подобных систем, с поддержкой логирования всех операций в файл `shell.log`.

---

## Архитектура проекта
```commandline
python-laba2/
├── src/                           # Исходный код проекта
│   ├── __init__.py                # Экспорт всех модулей
│   ├── command_cat.py             # Команда cat - вывод содержимого файла
│   ├── command_cd.py              # Команда cd - смена директории
│   ├── command_cp.py              # Команда cp - копирование файлов
│   ├── command_ls.py              # Команда ls - просмотр содержимого директории
│   ├── command_mv.py              # Команда mv - перемещение файлов
│   ├── command_rm.py              # Команда rm - удаление файлов
│   ├── log_setup.py               # Настройка логирования
│   ├── mini_shell.py              # Основная оболочка
│   └── shell.log                  # Файл журнала операций
├── tests/                         # Папка с тестами
│   ├── __init__.py                # Инициализация тестов
│   ├── cat_test.py                # Тесты для команды cat
│   ├── cd_test.py                 # Тесты для команды cd
│   ├── cp_test.py                 # Тесты для команды cp
│   ├── ls_test.py                 # Тесты для команды ls
│   ├── mv_test.py                 # Тесты для команды mv
│   ├── rm_test.py                 # Тесты для команды rm
│   └── test_log_setup.py          # Тесты для системы логирования
├── pyproject.toml                 # Конфигурация проекта
├── uv.lock                        # Файл блокировки зависимостей
├── requirements.txt               # Зависимости проекта
└── README.md                      # Документация
```
---

## Реализованные команды

### 1. Команда `ls` - просмотр содержимого директории
**Функция:** `ls(path=None, detailed=False)`

**Описание:** Выводит список файлов и директорий в указанном пути.

**Параметры:**
- `path` - путь к директории (по умолчанию текущая)
- `detailed` - флаг подробного вывода (`-l`)

**Особенности:**
- Подробный вывод с правами доступа, размером и временем изменения
- Обозначение директорий символом `/` в конце
- Автоматическая сортировка элементов

### 2. Команда `cd` - смена директории
**Функция:** `cd(path)`

**Описание:** Изменяет текущую рабочую директорию.

**Поддерживаемые символы:**
- `..` - переход на уровень выше
- `~` - переход в домашнюю директорию
- Относительные и абсолютные пути

**Защита:**
- Проверка существования директории
- Проверка типа (только директории)

### 3. Команда `cat` - вывод содержимого файла
**Функция:** `cat(file_path)`

**Описание:** Читает и выводит содержимое указанного файла.

**Особенности:**
- Чтение в кодировке UTF-8
- Проверка существования файла
- Защита от чтения директорий

### 4. Команда `cp` - копирование файлов и директорий
**Функция:** `cp(source, destination, recursive=False)`

**Описание:** Копирует файлы и директории из источника в назначение.

**Параметры:**
- `source` - исходный файл/директория
- `destination` - цель копирования
- `recursive` - флаг рекурсивного копирования (`-r`)

**Особенности:**
- Рекурсивное копирование директорий с содержимым
- Сохранение метаданных файлов
- Проверка существования источника

### 5. Команда `mv` - перемещение/переименование
**Функция:** `mv(source, destination)`

**Описание:** Перемещает или переименовывает файлы и директории.

**Особенности:**
- Использование `shutil.move`
- Обработка пересечения файловых систем
- Проверка существования источника

### 6. Команда `rm` - удаление файлов и директорий
**Функция:** `rm(target, recursive=False)`

**Описание:** Удаляет указанные файлы и директории.

**Параметры:**
- `target` - цель удаления
- `recursive` - флаг рекурсивного удаления (`-r`)

**Защитные механизмы:**
- Подтверждение при удалении директорий
- Запрет удаления корневой директории (`/`)
- Проверка существования цели

---

## Система логирования

### Модуль `log_setup.py`
**Функции:**
- `setup_logging()` - инициализация и очистка файла лога
- `log_command(command, success=True, error_msg="")` - запись операции

**Формат записей:**
- **Успешные операции:** `[2024-01-15 10:30:00] ls -l /home/user`
- **Ошибки:** `[2024-01-15 10:31:00] ERROR: No such file or directory`

**Особенности:**
- Автоматическое создание временных меток
- Чёткое разделение успешных операций и ошибок
- Кодировка UTF-8 для поддержки русских символов

---

## Основная оболочка

### Модуль `mini_shell.py`
**Компоненты:**
- `main()` - основной цикл оболочки
- `parse_command()` - парсинг пользовательского ввода
- Интеграция всех команд

**Интерфейс:**
- Отображение текущей директории в приглашении
- Поддержка пустого ввода (пропуск)
- Обработка `KeyboardInterrupt` (Ctrl+C)
- Глобальная обработка исключений

**Поддерживаемый синтаксис:**
```commandline
ls [path] [-l]
cd <path>
cat <file>
cp [-r] <source> <destination>
mv <source> <destination>
rm [-r] <target>
exit
```
---

## Примеры использования

### Сессия работы с оболочкой
```bash
/home/user $ ls
documents/ downloads/ file.txt

/home/user $ ls -l
drwxr-xr-x     4096 2024-01-15 10:00:00 documents/
drwxr-xr-x     4096 2024-01-15 10:01:00 downloads/
-rw-r--r--       42 2024-01-15 10:02:00 file.txt

/home/user $ cat file.txt
Hello, this is a test file.

/home/user $ cp file.txt file_backup.txt
/home/user $ ls
documents/ downloads/ file.txt file_backup.txt

/home/user $ mkdir test
/home/user $ mv file_backup.txt test/
/home/user $ ls test/
file_backup.txt

/home/user $ rm test/file_backup.txt
/home/user $ rmdir test
/home/user $ cd ~
/home $ exit
```
